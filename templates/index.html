<html lang="ru" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <title>{% block title %}{% endblock %}</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
        <a class="navbar-brand" href="/" id="heading">ГЛАВНАЯ</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <a class="nav-link active" aria-current="page" href="/">Разметка</a>
                <a class="nav-link" href="/submit">Закладка</a>
            </div>
        </div>
    </div>
</nav>


<div class="container bg-i" id="con">

    <div class="row">

        <form method="POST" action="" enctype="multipart/form-data">
            <input type="hidden" name="node_id" id="node_id" value="a">
            <p><input type="file" name="file"></p>
            <p><input type="submit" value="Submit"></p>
        </form>

        {#        <script async src="https://telegram.org/js/telegram-widget.js?22" data-telegram-login="conmon2023_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>#}
        {#<script type="text/javascript">#}
        {#  function onTelegramAuth(user) {#}
        {#    alert('Logged in as ' + user.first_name + ' ' + user.last_name + ' (' + user.id + (user.username ? ', @' + user.username : '') + ')');#}
        {#  }#}
        {#</script>#}


        {% block body %}{% endblock %}

        <div id="jstree"></div>
        <input type="button" value="Отправить" onclick="send_tree()">
{#        <form method="POST" action="" enctype="multipart/form-data">#}
{#            <input type="hidden" name="send_tree" id="send_tree">#}
{#            <p><input type="submit" value="Submit"></p>#}
{#        </form>#}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
        <script>function send_tree() {
            $.ajax({
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify($('#jstree').jstree(true).get_json('#', {
                    no_state: true,
                    flat: true,
                    no_data: true
                })),
                dataType: 'json',
                url: 'http://127.0.0.1:5000/tree'
            });
        }

        $(function () {
            let True = true;
            let False = false;
            // Create an jstree instance
            $('#jstree').jstree({ // config object start

                "core": {                    // core config object
                    "mulitple": false,         // disallow multiple selection
                    "animation": 100,          // 200ms is default value
                    "check_callback": true,   // this make contextmenu plugin to work
                    "themes": {
                        "stripes": true,
                        "variant": "medium",
                        "dots": false
                    },

                    "data": {{ js|safe }}

                },
                "types": {
                    "#": {
                        "valid_children": ["root"]
                    },
                    "root": {
                        "valid_children": ["default"]
                    },
                    "default": {
                        "valid_children": ["default", "file"]
                    },
                    "file": {
                        "icon": "glyphicon glyphicon-file",
                        "valid_children": []
                    }
                },


                "plugins": [
                    "types",
                    "wholerow",
                    "contextmenu",
                    "dnd",
                    "massload",
                    "search",
                    "sort",
                    "state",
                    "types",
                    "unique",
                    "changed"
                ]
            })

                .bind("dblclick.jstree", function (event) {
                    var tree = $(this).jstree();
                    var node = tree.get_node(event.target);
                    {#var data = node.data("jstree");#}
                    console.log(JSON.stringify(node))
                    $.ajax({

                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify(node),
                        dataType: 'json',
                        url: 'http://127.0.0.1:5000/'
                    });
                })
                .on("select_node.jstree", function (evt, data) {
                    $("#node_id").val(data.node.id)
                })
                .on("changed.jstree", function () {
                    $("#send_tree").val(JSON.stringify($('#jstree').jstree(true).get_json('#', {
                        no_state: true,
                        flat: true,
                        no_data: true
                    })));
                })


        })


        </script>

        <style>#simple-treeview,
        #product-details {
            display: inline-block;
        }

        #product-details {
            vertical-align: top;
            width: 400px;
            height: 420px;
            margin-left: 20px;
        }

        #product-details > img {
            border: none;
            height: 300px;
            width: 400px;
        }

        #product-details > .name {
            text-align: center;
            font-size: 20px;
        }

        #product-details > .price {
            text-align: center;
            font-size: 24px;
        }

        .dark #product-details > div {
            color: #f0f0f0;
        }

        .hidden {
            visibility: hidden;
        }
        </style>

    </div>


</div>

</body>

</html>
